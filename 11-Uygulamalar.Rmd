# Uygulamalar

## CS_1 (NYC Flights)

```{r message=FALSE, warning=FALSE}
library(corrr)
library(tidyverse)
library(nycflights13)
```

2013 yılında NYC'den kalkan uçuşlar ile ilgili veri setlerini içeren **nycflights13** paketi ile çalışacağız. Veri seti `airlines, airports, flights, planes` ve `weather` verilerini içermektedir. (Veri setlerinin detayı için **nycflights13** paketini inceleyiniz.) 

Bu çalışmada, farklı veri setlerindeki bilgileri birlikte kullanabilmeniz, dönüştürmeniz, görselleştirmeniz ve çıkarımda bulunmanız hedeflenmektedir.


Her bir veri setini `View()` komutu ile ayrı bir tablo olarak açıp detaylı inceleyiniz, süreci kavrayabilmeniz için veri setine hakim olmanız gerekmektedir.

```{r message=FALSE, warning=FALSE}
View(planes)  #ornegin
```

Veri setlerini dikkatle incelediğinizde farklı veri setlerinin ortak değişkenler içerdiğini göreceksiniz, bu sizin veri setlerini birbirine bağlayarak daha fazla veri üzerinden çalışmanızı sağlayacaktır.

Ortak değişkenler ve veri setleri için örnek olarak;

planes ve flights veri setlerinde tailnum değişkeni

flights ve weather veri setlerinde origin, year, month, day, hour değişkenleri

flights ve airlines veri setlerinde carrier değişkeni


**Soru1.** Havada kalış süresi (air_time) en fazla olan uçak için üretim yılı (year), üretici (manufacturer) ve model (model) bilgisi nedir? **(Kodunuzda hata alıyorsanız year değişkenini verinizde kontrol ediniz!)**

```{r message=FALSE, warning=FALSE}

data1<- left_join(flights,planes,by="tailnum") 

data1 %>% filter(air_time==max(air_time,na.rm = T)) %>%
  select(year.y, manufacturer,model)
```

**Soru2.** Havada kalış süresi (air_time), sıcaklık (temp), rüzgar hızı (wind_speed) ve nem (humid) arasında ne tür bir ilişki vardır? İnceleyip yorumlayınız.

```{r message=FALSE, warning=FALSE}
data2<- left_join(weather,flights,by=c("origin","year","month","day","hour"))
data2 %>% select(air_time,temp,wind_speed,humid) %>% 
correlate() 
```


**Soru3.** Her bir hava yolu şirketi (name) için ortalama ve ortanca gecikme süresilerini (dep_delay) inceleyip yorumlayınız.

```{r message=FALSE, warning=FALSE}
data3<- right_join(airlines,flights,by="carrier")
data3 %>% filter(dep_delay>0) %>% na.omit() %>% group_by(name) %>% summarise(mean=mean(dep_delay),median=median(dep_delay))

```



**Soru4.** flights veri setinde yer alan gecikme süresi (dep_delay) değişkeni için 2013 yılı ortalama gecikme süresi kaçtır? (erken varışları dikkate almayınız.)



```{r message=FALSE, warning=FALSE}
flights %>% filter(dep_delay>0) %>% summarise(mean=mean(dep_delay))
```




## CS_2 (Sean 'Lahman' Baseball Database)

```{r message=FALSE, warning=FALSE}
library(Lahman)
library(tidyverse)
```


Case Study_2 için **Lahman** paketi içerisinde yer alan `People`, `AwardsPlayers` ve `Salaries` veri setleri üzerinde çalışacaksınız. Veri setlerini inceleyiniz ve aşağıda yer alan sorular paralelinde hazırlanmış olan test sorularını yanıtlayınız.

```{r message=FALSE, warning=FALSE}
View(People)
```
Bu çalışmada ortak değişkenleri sizin tespit etmeniz gerekmektedir.


**Soru1.** AwardsPlayers veri setini incelediğinizde en çok ödül alan oyuncu kimdir? (People veri seti nameFirst ve nameLast değişkenleri ile yanıtlayınız.)


```{r message=FALSE, warning=FALSE}
t<-table(AwardsPlayers$playerID) %>% as.data.frame()
names(t)<-c("playerID","num.of.aw")
data1<-People %>% left_join(t,by="playerID")    # hepsine na.omit() uygulamak?
data1 %>% filter(num.of.aw==max(num.of.aw,na.rm=T)) %>%   
  select(nameFirst,nameLast)

```


**Soru2.** People veri setinde yer alan weight ve height değişkenlerini kullanarak body mass index (BMI) hesaplayınız. BMI formülü ve değerlendirme tablosu aşağıda yer almaktadır.

$BMI=\frac{weight}{height^{2}}*703$

<br>

|BMI|Classification|
|:-:|:------------:|
|<18.5|Under weight|
|18.5-24.9|Normal weight|
|25-29.9|Over weight|
|30-34.9|Obesity class 1|
|35-39.9|Obesity class 2|
|40 or above|Obesity class 3|

<br>

Oyunculardan kaç tanesi normal weight kategorisine girmektedir?

```{r message=FALSE, warning=FALSE}
People %>% mutate(BMI=weight/(height^2)*703) %>% filter(BMI>=25 & BMI<29.9) %>% nrow()
  
```

**Soru3.** Salaries ve AwardsPlayers veri setlerini inceleyiniz, en fazla ödül alan oyuncunun en yüksek maaşa sahip olduğu söylenebilir mi? 

```{r message=FALSE, warning=FALSE}
#soru 1 de odul sayilari hesaplandi (t)

data2<-Salaries %>% left_join(t,by="playerID") 
which.max(data2$salary)==which.max(data2$num.of.aw)

slice(data2,which.max(data2$salary))     #max salary
slice(data2,which.max(data2$num.of.aw))  #max num of awards
```

**Soru4.** En çok alınan ödül hangisidir?

```{r message=FALSE, warning=FALSE}
table(AwardsPlayers$awardID) %>% as.data.frame() %>% arrange(desc(Freq))
```



## CS_3 (Diamonds)

```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(tidyverse)
```


**Soru1.** diamonds veri setinde yer alan x, y ve z değişkenleri kullanılarak yeni bir t değişkeni oluşturuluyor. t değişkeni $t=x^{2}-\sqrt{y}+z^{-2}$ şeklinde tanımlanacak olursa, en düşük t değerine karşılık gelen depth değeri nedir?

```{r message=FALSE, warning=FALSE}
diamonds %>% mutate(t=x^2-sqrt(y)+(1/z)) %>% filter(t==min(t)) %>% select(depth)
```



**Soru2.** Pandemi nedeniyle azalan satışlarını hareketlendirmek isteyen bir mağaza sahibi ürünlerine cut değişkenine bağlı olarak indirim uyguluyor. İndirim oranları aşağıdaki gibidir.

|Cut|Discount|
|:-:|:------:|
|Fair|price*0.01|
|Good|price*0.02|
|Very Good|price*0.025|
|Premium|price*0.03|
|Ideal|price*0.03|

İndirimli fiyatlar üzerinden alışveriş yapan bir müşteri 'E color' ve 'SI1 clarity' ürün için en az kaç $ ödeyecektir?

```{r message=FALSE, warning=FALSE}
diamonds %>% mutate(discount = case_when(
  cut=="Fair" ~ price*0.01,
  cut=="Good" ~ price*0.02,
  cut=="Very Good" ~ price*0.025,
  cut=="Premium" ~ price*0.03,
  cut=="Ideal" ~ price*0.03,
),new.price=price-discount) %>% filter(color=="E" & clarity=="SI2" & new.price==min(new.price)) 





```


Alternatif,

```{r message=FALSE, warning=FALSE}
diamonds %>% mutate(discount= case_when(
  cut=="Fair" ~ price*0.1,
  cut=="Good" ~ price*0.12,
  cut=="Very Good" ~ price*0.15,
  cut=="Premium" ~ price*0.18,
  cut=="Ideal" ~ price*0.18,
),new.price=price-discount) %>% filter(color=="E"& clarity=="SI1") %>% arrange(new.price)
```




**Soru3.** diamonds verisi clarity değişkeni kaç farklı level içermektedir? (Kaç farklı clarity tipi vardır?)

```{r message=FALSE, warning=FALSE}
cl<-diamonds$clarity %>% as.factor() 
cl %>% levels()
cl %>% nlevels()

```

**Soru4.** Mağazanın 'Ideal' cut tipine sahip ürünlerden elde ettiği ortalama kazanç nedir?

```{r message=FALSE, warning=FALSE}
diamonds %>% group_by(cut) %>% summarise(mean.pr=mean(price))
```

Alternatif,

```{r message=FALSE, warning=FALSE}
diamonds %>% filter(cut=="Ideal") %>% summarise(mean(price))
```

**Soru5.** Mağazanın cut tipine göre elde ettiği price ortalamaları incelendiğinde en az kazanç sağlayan cut tipi hangisidir?
 

